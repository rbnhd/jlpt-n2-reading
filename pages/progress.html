<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="JLPT N2 å­¦ç¿’é€²æ— - ã‚ãªãŸã®å­¦ç¿’è¨˜éŒ²ã¨çµ±è¨ˆ">
  <title>å­¦ç¿’é€²æ— - JLPT N2 èª­è§£ç·´ç¿’</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/components.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <nav class="nav-bar">
        <div class="nav-logo">
          <a href="../index.html">N2 èª­è§£ç·´ç¿’</a>
        </div>
        <button id="navToggle" class="nav-toggle" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <ul class="nav-menu">
          <li><a href="../index.html">ãƒ›ãƒ¼ãƒ </a></li>
          <li><a href="practice.html">ç·´ç¿’å•é¡Œ</a></li>
          <li><a href="vocabulary.html">èªå½™</a></li>
          <li><a href="grammar.html">æ–‡æ³•</a></li>
          <li><a href="progress.html" class="active">é€²æ—</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="main-content">
    <section class="page-hero">
      <div class="container">
        <h1>å­¦ç¿’é€²æ—</h1>
        <p>ã‚ãªãŸã®å­¦ç¿’è¨˜éŒ²ã¨çµ±è¨ˆã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†</p>
      </div>
    </section>

    <section class="progress-section">
      <div class="container">
        <!-- Overall Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">ğŸ“š</div>
            <div class="stat-value" id="totalAttempts">0</div>
            <div class="stat-label">è§£ã„ãŸå•é¡Œæ•°</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">âœ…</div>
            <div class="stat-value" id="correctAnswers">0</div>
            <div class="stat-label">æ­£è§£æ•°</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-value" id="accuracyRate">0%</div>
            <div class="stat-label">æ­£ç­”ç‡</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">ğŸ”¥</div>
            <div class="stat-value" id="currentStreak">0</div>
            <div class="stat-label">é€£ç¶šå­¦ç¿’æ—¥æ•°</div>
          </div>
        </div>

        <!-- Category Performance -->
        <div class="section-card">
          <h2>ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥æˆç¸¾</h2>
          <div id="categoryStats" class="category-stats">
            <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="section-card">
          <h2>æœ€è¿‘ã®å­¦ç¿’å±¥æ­´</h2>
          <div id="recentActivity" class="recent-activity">
            <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button onclick="exportProgress()" class="btn btn-secondary">
            ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
          </button>
          <button onclick="resetProgress()" class="btn btn-danger">
            ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
          </button>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>&copy; 2024 JLPT N2 èª­è§£ç·´ç¿’ã‚µã‚¤ãƒˆ</p>
      <nav class="footer-nav">
        <a href="about.html">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
        <a href="privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
        <a href="tips.html">å­¦ç¿’ã®ã‚³ãƒ„</a>
      </nav>
    </div>
  </footer>

  <script type="module" src="../js/app.js"></script>
  <script type="module">
    import { getStats, initialiseStats } from '../js/progress-tracker.js';

    function renderProgressPage() {
      const stats = getStats();
      
      // Overall stats
      document.getElementById('totalAttempts').textContent = stats.totalAttempts || 0;
      document.getElementById('correctAnswers').textContent = stats.correctAnswers || 0;
      
      const accuracy = stats.totalAttempts > 0 
        ? Math.round((stats.correctAnswers / stats.totalAttempts) * 100)
        : 0;
      document.getElementById('accuracyRate').textContent = accuracy + '%';
      document.getElementById('currentStreak').textContent = stats.currentStreak || 0;

      // Category stats
      renderCategoryStats(stats);

      // Recent activity
      renderRecentActivity(stats);
    }

    function renderCategoryStats(stats) {
      const container = document.getElementById('categoryStats');
      const categories = stats.byCategory || {};

      if (Object.keys(categories).length === 0) {
        container.innerHTML = '<div class="no-data">ã¾ã å•é¡Œã‚’è§£ã„ã¦ã„ã¾ã›ã‚“</div>';
        return;
      }

      const categoryNames = {
        news: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹',
        essay: 'ã‚¨ãƒƒã‚»ã‚¤',
        story: 'ç‰©èª',
        business: 'ãƒ“ã‚¸ãƒã‚¹',
        academic: 'å­¦è¡“'
      };

      container.innerHTML = Object.entries(categories).map(([cat, data]) => {
        const accuracy = data.attempts > 0 
          ? Math.round((data.correct / data.attempts) * 100)
          : 0;
        
        return `
          <div class="category-stat-item">
            <div class="category-name">${categoryNames[cat] || cat}</div>
            <div class="category-details">
              <span>è§£ç­”æ•°: ${data.attempts}</span>
              <span>æ­£ç­”ç‡: ${accuracy}%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${accuracy}%"></div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderRecentActivity(stats) {
      const container = document.getElementById('recentActivity');
      const history = stats.history || [];

      if (history.length === 0) {
        container.innerHTML = '<div class="no-data">ã¾ã å­¦ç¿’å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }

      // Show last 10 activities
      const recent = history.slice(-10).reverse();

      container.innerHTML = recent.map(entry => {
        const date = new Date(entry.timestamp);
        const dateStr = date.toLocaleDateString('ja-JP');
        const timeStr = date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        const accuracy = entry.total > 0 
          ? Math.round((entry.correct / entry.total) * 100)
          : 0;

        return `
          <div class="activity-item">
            <div class="activity-header">
              <span class="activity-date">${dateStr} ${timeStr}</span>
              <span class="activity-score ${accuracy >= 80 ? 'good' : accuracy >= 60 ? 'ok' : 'poor'}">
                ${entry.correct}/${entry.total} (${accuracy}%)
              </span>
            </div>
            <div class="activity-passage">${entry.passageId}</div>
          </div>
        `;
      }).join('');
    }

    window.exportProgress = function() {
      const stats = getStats();
      const dataStr = JSON.stringify(stats, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `n2-reading-progress-${Date.now()}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      alert('é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
    };

    window.resetProgress = function() {
      if (!confirm('æœ¬å½“ã«å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        return;
      }
      
      localStorage.removeItem('n2-reading-progress');
      initialiseStats();
      renderProgressPage();
      alert('å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
    };

    // Initialize
    initialiseStats();
    renderProgressPage();
  </script>
</body>
</html>
