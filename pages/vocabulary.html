<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="JLPT N2 èªå½™å­¦ç¿’ - 1600èªã®é‡è¦å˜èªã‚’åˆ†é‡åˆ¥ã«å­¦ç¿’">
  <title>èªå½™å­¦ç¿’ - JLPT N2 èª­è§£ç·´ç¿’</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/components.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <nav class="nav-bar">
        <div class="nav-logo">
          <a href="../index.html">N2 èª­è§£ç·´ç¿’</a>
        </div>
        <button id="navToggle" class="nav-toggle" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <ul class="nav-menu">
          <li><a href="../index.html">ãƒ›ãƒ¼ãƒ </a></li>
          <li><a href="passage-list.html">ç·´ç¿’å•é¡Œ</a></li>
          <li><a href="vocabulary.html" class="active">èªå½™</a></li>
          <li><a href="grammar.html">æ–‡æ³•</a></li>
          <li><a href="progress.html">é€²æ—</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="main-content">
    <section class="page-hero">
      <div class="container">
        <h1>N2èªå½™å­¦ç¿’</h1>
        <p>JLPT N2ãƒ¬ãƒ™ãƒ«ã®é‡è¦å˜èª1600èªã‚’åˆ†é‡åˆ¥ã«å­¦ç¿’ã—ã¾ã—ã‚‡ã†</p>
      </div>
    </section>

    <section class="vocabulary-section">
      <div class="container">
        <!-- Filters and Search -->
        <div class="vocab-controls">
          <div class="search-box">
            <input 
              type="text" 
              id="vocabSearch" 
              placeholder="å˜èªã‚’æ¤œç´¢..."
              aria-label="èªå½™ã‚’æ¤œç´¢">
          </div>
          
          <div class="filter-group">
            <label for="categoryFilter">åˆ†é‡:</label>
            <select id="categoryFilter">
              <option value="all">ã™ã¹ã¦</option>
              <option value="social">ç¤¾ä¼šå•é¡Œ</option>
              <option value="daily">æ—¥å¸¸ç”Ÿæ´»</option>
              <option value="business">ãƒ“ã‚¸ãƒã‚¹</option>
              <option value="academic">å­¦è¡“</option>
              <option value="abstract">æŠ½è±¡æ¦‚å¿µ</option>
              <option value="abstract-concepts">æŠ½è±¡çš„æ¦‚å¿µ</option>
              <option value="daily-life">æ—¥å¸¸ç”Ÿæ´»è©³ç´°</option>
              <option value="technology">æŠ€è¡“</option>
            </select>
          </div>

          <div class="vocab-stats">
            <span id="vocabCount">0</span> èªè¡¨ç¤ºä¸­
          </div>
        </div>

        <!-- Vocabulary List -->
        <div id="vocabList" class="vocab-grid">
          <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="vocabPagination"></div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>&copy; 2025 JLPT N2 èª­è§£ç·´ç¿’ã‚µã‚¤ãƒˆ</p>
      <nav class="footer-nav">
        <a href="about.html">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
        <a href="privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
        <a href="tips.html">å­¦ç¿’ã®ã‚³ãƒ„</a>
      </nav>
    </div>
  </footer>

  <script type="module" src="../js/app.js?v=2"></script>
  <script type="module">
    // Vocabulary page logic
    let allVocabulary = [];
    let filteredVocabulary = [];
    const ITEMS_PER_PAGE = 50;
    let currentPage = 1;

    const vocabFiles = [
      'social', 'daily', 'business', 'academic', 
      'abstract', 'abstract-concepts', 'daily-life', 'technology'
    ];

    async function loadAllVocabulary() {
      const promises = vocabFiles.map(async (category) => {
        try {
          const response = await fetch(`../data/vocabulary/vocab-${category}.json`);
          const data = await response.json();
          return data.items.map(item => ({
            ...item,
            category: category
          }));
        } catch (error) {
          console.error(`Failed to load ${category} vocabulary:`, error);
          return [];
        }
      });

      const results = await Promise.all(promises);
      allVocabulary = results.flat();
      filteredVocabulary = [...allVocabulary];
      renderVocabulary();
    }

    function filterVocabulary() {
      const searchTerm = document.getElementById('vocabSearch').value.toLowerCase();
      const category = document.getElementById('categoryFilter').value;

      filteredVocabulary = allVocabulary.filter(item => {
        const matchesSearch = !searchTerm || 
          (item.kanji && item.kanji.includes(searchTerm)) ||
          (item.kana && item.kana.includes(searchTerm)) ||
          (item.word && item.word.includes(searchTerm)) ||
          (item.reading && item.reading.includes(searchTerm)) ||
          (item.meaning && item.meaning.toLowerCase().includes(searchTerm));
        
        const matchesCategory = category === 'all' || item.category === category;

        return matchesSearch && matchesCategory;
      });

      currentPage = 1;
      renderVocabulary();
    }

    function renderVocabulary() {
      const container = document.getElementById('vocabList');
      const countElement = document.getElementById('vocabCount');
      
      countElement.textContent = filteredVocabulary.length;

      const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIndex = startIndex + ITEMS_PER_PAGE;
      const pageItems = filteredVocabulary.slice(startIndex, endIndex);

      if (pageItems.length === 0) {
        container.innerHTML = '<div class="no-results">è©²å½“ã™ã‚‹èªå½™ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>';
        renderPagination();
        return;
      }

      container.innerHTML = pageItems.map(item => {
        const word = item.kanji || item.word || '';
        const reading = item.kana || item.reading || '';
        const meaning = item.meaning || '';
        const example = item.exampleSentence || (item.examples && item.examples[0]?.sentence) || '';
        const translation = item.exampleTranslation || (item.examples && item.examples[0]?.translation) || '';

        // URL encode the word for dictionary links
        const encodedWord = encodeURIComponent(word);

        return `
          <div class="vocab-card">
            <div class="vocab-header">
              <div class="vocab-word">${word}</div>
              <div class="vocab-reading">${reading}</div>
            </div>
            <div class="vocab-meaning">${meaning}</div>
            ${example ? `
              <div class="vocab-example">
                <div class="example-sentence">${example}</div>
                <div class="example-translation">${translation}</div>
              </div>
            ` : ''}
            <div class="vocab-dict-buttons">
              <a href="https://jisho.org/search/${encodedWord}" target="_blank" rel="noopener noreferrer" class="dict-button">
                ğŸ“– Jisho
              </a>
              <a href="https://jotoba.de/search/0/${encodedWord}?l=en-US" target="_blank" rel="noopener noreferrer" class="dict-button">
                ğŸ“š Jotoba
              </a>
            </div>
          </div>
        `;
      }).join('');

      renderPagination();
    }

    function renderPagination() {
      const container = document.getElementById('vocabPagination');
      const totalPages = Math.ceil(filteredVocabulary.length / ITEMS_PER_PAGE);

      if (totalPages <= 1) {
        container.innerHTML = '';
        return;
      }

      let html = '<button onclick="goToPage(1)" ' + (currentPage === 1 ? 'disabled' : '') + '>æœ€åˆ</button>';
      html += '<button onclick="goToPage(' + (currentPage - 1) + ')" ' + (currentPage === 1 ? 'disabled' : '') + '>å‰ã¸</button>';
      
      for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
        html += '<button onclick="goToPage(' + i + ')" ' + (i === currentPage ? 'class="active"' : '') + '>' + i + '</button>';
      }

      html += '<button onclick="goToPage(' + (currentPage + 1) + ')" ' + (currentPage === totalPages ? 'disabled' : '') + '>æ¬¡ã¸</button>';
      html += '<button onclick="goToPage(' + totalPages + ')" ' + (currentPage === totalPages ? 'disabled' : '') + '>æœ€å¾Œ</button>';

      container.innerHTML = html;
    }

    window.goToPage = function(page) {
      const totalPages = Math.ceil(filteredVocabulary.length / ITEMS_PER_PAGE);
      if (page < 1 || page > totalPages) return;
      currentPage = page;
      renderVocabulary();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // Event listeners
    document.getElementById('vocabSearch').addEventListener('input', filterVocabulary);
    document.getElementById('categoryFilter').addEventListener('change', filterVocabulary);

    // Initialize
    loadAllVocabulary();
  </script>
</body>
</html>
